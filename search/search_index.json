{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to my Smart Home!","text":"HomeLiving RoomBedroomBalconySystem <p>This is my personal Home Assistant configuration, awakening my home with automations. I hope this will help you inspire on the way to built your own smart home.</p> <p>Beware of changes</p> <p>I constantly improve my home. It evolves as I add new devices and services. It's changing as my daily routines are changing.</p> <p>Please, keep in mind this documentation might be outdated in covering some details. However, I'll try my best to keep this updated.</p> <p>The best way to discover new ideas and inspire is by reading the code, copying-pasting parts of my configuration and adjusting it to your needs.</p> <p>Read this documentation to see the bigger picture:</p> <p>Hardware Software Home Assistant Resources</p>"},{"location":"#whats-inside","title":"What's inside?","text":"<p>My home setup for those who are too lazy to read everything:</p> <ul> <li>Raspberry Pi 4B as a home server.</li> <li>Home Assistant for home automations.</li> <li>Mosquitto and zigbee2mqtt for Zigbee devices.</li> <li>Reverse proxy using Nginx Proxy Manager with CloudFlare.</li> <li>OpenVPN for SSH and Samba access.</li> <li>Pi-hole for blocking ads within home network.</li> <li>Plex Media Server with an external hard drive for hosting movies and TV series.</li> <li>Transmission for downloading new media to the hard drive.</li> <li>Vaultwarden for password management (Rust implementation of Bitwarden).</li> </ul>"},{"location":"#motivation","title":"Motivation","text":"<p>I write this documentation for two main reasons:</p> <ol> <li>To keep track of growing my smart home. To maintain an understanding of how things are working.</li> <li>To help other enthusiasts inspire. People often ask about my smart home setup. Now I can give them a link to this documentation, instead of explaining everything once again.</li> </ol>"},{"location":"#limitations","title":"Limitations","text":"<p>I'm renting my apartment. My landlord handles fixing stuff in my home, covering all the expenses. The only downside is that I can't change anything in my home.</p> <p>I can't disassemble anything and use custom switches or sockets. It means I can change only easily accessible parts, like bulbs.</p>"},{"location":"#future-plans","title":"Future Plans","text":"<p>I have a public Notion board with ideas and tasks for my smart home. You can follow and comment my plans there.</p> <p>See future plans</p>"},{"location":"#license","title":"License","text":"<p>MIT \u00a9 Denys Dovhan</p>"},{"location":"hardware/","title":"Hardware","text":"<p>This is the list of the hardware that is present in my smart home.</p>"},{"location":"hardware/#home-server","title":"Home Server","text":"<p>The heart of my smart home is a home server based on Raspberry Pi 4 Model B with 4GB of RAM onboard. It's a small, affordable, but nonetheless a very capable device. It's held within an aluminum alloy case I bought on AliExpress. The aluminum case itself helps to disperse heat. Additionally, it came with a heat sink set and a tiny cooling fan.</p> <p>Info</p> <p>Home Assistant team recommands to use Application Class 2 as they handle small I/O much more consistently than cards not optimized to host applications. A 32 GB or bigger card is recommended.</p> <p>I use official Raspberry Pi 15W USB-C Power Supply for powering my smart home server. It is important to get enough power for Raspberry Pi to work properly. Home Assistant requires at least 3A power and this power supply cable handles it just right.</p> Home Server HardwareAlluminium Case AssemblingAssembled and Connected <p>Here's a photo of my home server hardware, right after I received it:</p> <p></p> <p>A photo of the aluminum case when I was assembling it:</p> <p></p> <p>Here's a whole kit assembled and connected to power:</p> <p></p>"},{"location":"hardware/#storage","title":"Storage","text":"<p>I use Kingston SSDNow A400 240GB 2.5\" as a system data storage. It's connected to Raspberry Pi via Ugreen US221 USB 3.0 case adapter. As a media storage I use Transcend StoreJet 25M3 2TB hard drive (which I got from my dad as my birthday present in 2020). Both storages are connecterd via USB 3.0 interface on Raspberry to allow high speed reading, so I can easily stream my media using Plex.</p> <p>Media is downloaded directly to my HDD using Transmission container.</p> SSD and HDD Assembled and ConnectedSSD whithin a CaseHDD Connected <p></p> <p></p> <p></p> <p>Info</p> <p>Previously, I used a SanDisk Extreme Pro MicroSD A2 V30 128GB (previously 64GB).</p> <p>Previous 64GB SD-card served well for more than 2 years. After some time, my server started to shutdown randomly. Power supply was normal, so I decided to update to 128GB card.</p>"},{"location":"hardware/#wifi-network","title":"WiFi Network","text":"<p>You're going to have a lot of devices in your network when you have a smart home. It's critical to choose a good router to handle multiple devices and heavy traffic.</p>"},{"location":"hardware/#wireless-router","title":"Wireless Router","text":"<p>The second most important thing in my smart home is a WiFi router.</p> <p>I've spent a lot of time choosing the right router. My main requirements for the router were:</p> <ul> <li>Dual-band: 2.4GHz and 5GHz \u2014 Primarily, I use two networks in my home: 2.4GHz for smart devices and 5GHz for personal devices like phones and laptops. 5GHz uses shorter radio waves, and that provides faster speeds.</li> <li>MU-MIMO \u2014 This is a technology that enables simultaneous communication to multiple devices, improving overall speed and enabling network multitasking. It is critical when you have lots of connected devices and want each of them to work with the highest speed.</li> <li>802.11ac \u2014 this is a so-called WiFi5 standard. It allows increased speeds and improved scalability. I have a gigabyte connection at my home and wanted to benefit from it.</li> </ul> <p>I chose ASUS RT-AC1750U router for my home. It matches every condition above and has nice additional features. Also, I've noticed that routers by ASUS are quite respected among other smart-home enthusiasts.</p> <p>I'm happy with my decision so far. This router gives the constant 600-900 Mbit/s speed, which is enough to download a 10GB file in less than 2 minutes.</p> <p>Previously, I've also tried Xiaomi Router and wasn't happy about it. Xiaomi Router has UI in Chinese and worked unreliably overall.</p> <p>Here are my current ASUS and former Xiaomi routers:</p> <p></p>"},{"location":"hardware/#devices","title":"Devices","text":"<p>Below you will find a list of my devices connected to the local network. Most of them, except for Apple TV, have static IP addresses.</p> Device IP HA Integration Apple TV 4K <code>192.168.50.x</code>* Apple TV Koogeek P1EU Smart Plug <code>192.168.50.9</code> HomeKit Controller Koogeek P1EU Smart Plug <code>192.168.50.10</code> HomeKit Controller Koogeek P1EU Smart Plug <code>192.168.50.11</code> HomeKit Controller Samsung 55\" Q67R 4K Smart QLED TV <code>192.168.50.93</code> ha-samsungtv-tizen** Raspberry Pi <code>192.168.50.113</code>* \u2013 Yeelight LED Bulb 1S (Color) <code>192.168.50.128</code> Yeelight Yeelight LED Bulb 1S (Color) <code>192.168.50.129</code> Yeelight Xiaomi Bulb White and Color <code>192.168.50.130</code> Yeelight Xiaomi Desk Lamp Pro <code>192.168.50.131</code> Yeelight PlayStation 4 Pro <code>192.168.50.185</code>* Sony PlayStation 4 Roborock S5 Max <code>192.168.50.186</code> Xiaomi Miio Deerma Humidifier (mjjsq) <code>192.168.50.187</code> xiaomi_airpurifier** Xiaomi Air Purifier 3H <code>192.168.50.188</code> Xiaomi Miio Google Home Mini <code>192.168.50.220</code> Google Cast Google Nest Mini <code>192.168.50.221</code> Google Cast living-room-ac <code>192.168.50.x</code> ESPHome bedroom-ac <code>192.168.50.x</code> ESPHome <p>* \u2014 means the device is connected via Ethernet instead of WiFi to ensure a more reliable connection.</p> <p>** \u2014 means the device is integrated via custom integration.</p>"},{"location":"hardware/#esp-devices","title":"ESP Devices","text":"<p>I use two ESP8266 devices based on iot-uni-dongle for controlling my Midea ACs.</p> <p></p>"},{"location":"hardware/#zigbee-network","title":"Zigbee Network","text":"<p>My Zigbee devices are connected to Home Assistant via SMARTLIGHT CC2652P Zigbee USB Adapter SLZB-02 as a coordinator. Devices are controlled by Home Assistant via: zigbee2mqtt + Mosquitto + MQTT Integration.</p> <p>Note</p> <p>Previosly my Zigbee network was working with CC2531 Sniffer Board as a coordinator. It was fine with small amount of devices, but as my network grew I started to get weird behavior. Additioanlly, I've discovered that CC2531 is no longer recommended by zigbee2mqtt developers.</p> <p>Tip</p> <p>I connected my coordinator to the Raspberry Pi through a USB extension cable to avoid interference and improve the connection. This approach is suggested by zigbee2mqtt documentation.</p> <p>I used to use Aqara Hub, but it switched to the current approach because of its compatibility. The current approach allows binding together nearly every possible Zigbee device.</p>"},{"location":"hardware/#devices_1","title":"Devices","text":"Device Quantity Notes Aqara Smart LED Bulb 9W 5 Ceiling and Main lights Aqara Motion Sensor 2 Detecting motions in both rooms Aqara Magic Cube Controller 1 Controlling lights, scenes and modes Aqara Conditions Sensor 1 Internal temperature, humidity and pressure data Aqara Contact Sensor 1 Detection front door opening Aqara Single Switch Module T1 (without neutral) 1 Switching corridor light MiJia Conditions Sensor 1 Internal temperature and humidity data Tuya Smart ZigBee Radiator 2 Adjusting heaters temperature Lonsonho 2-Gang Switch 2 (without neutral) 1 Switching kitchen lights"},{"location":"hardware/#media-volume","title":"Media Volume","text":"<p>I've got a Transcend StoreJet 25M3 2TB hard drive from my dad as my birthday present in 2020.</p> <p>I have this HDD connected to my Raspberry Pi. It is used as a storage for my media files (primarly movies and TV-series). USB 3.0 interface on Raspberry allows high speed reading, so I can easily stream my media using Plex.</p> <p>Media is downloaded directly to my HDD using Transmission container.</p>"},{"location":"hardware/#other-devices","title":"Other Devices","text":"<p>Another important device is a smart car alarm. I used StarLine AS96 BT GSM GPS which is easily integrated with Home Assistant via built-in StarLine integration.</p> <p>This alarm allows to start/stop the engine, arm/disarm the alarm, trigger horn remotely via Home Assistant. Primarily, I use this for tracking down my car and checking interior temperature right from Home Assistant.</p>"},{"location":"resources/","title":"Resources","text":"<p>On this page, I'm trying to collect useful resources I used to improve my home:</p>"},{"location":"resources/#configurations","title":"Configurations","text":"<ul> <li>MacBury Smart House very cool and complex setup. I was inspired a lot by this.</li> <li>Frenck's Home Assistant Configuration unusual folder structure.</li> </ul>"},{"location":"resources/#articles-and-guides","title":"Articles and Guides","text":"<ul> <li>How I set up room-cleaning automation with Google Home, Home-Assistant and Xiaomi vacuum cleaner</li> <li>Actionable Notifications for   Home Assistant</li> <li>Docker Compose MariaDB Multiple Database about provisioning MariaDB databases.</li> <li>Consistent and well planned paths in Sonarr and Radarr</li> <li>TRaSH-Guides for properly configuring Sonarr, Radarr, Plex, etc</li> <li>Hardlinks and Instant Moves (Atomic-Moves) by TRaSH Guides</li> </ul>"},{"location":"resources/#youtube-channels","title":"YouTube Channels","text":"<ul> <li>JuanMTech YouTube Channel about general Home Assistant setup. Very high-quality videos.</li> <li>Zack Barett YouTube Channel mostly about Lovelace UI configuration and new Home Assistant features.</li> <li>DrZzs YouTube Channel about almost every possible smart-home related stuff. His hovering talking head might look a bit weird and even creepy, but the content itself is very useful.</li> <li>Grayson Adams about devices overview, basic Home Assistant setup.</li> <li>DB Tech generally about server administration. Mostly about Docker, Portainer, self-hosted services, OpenMediaVault, and Raspberry Pi. Very high-quality videos.</li> </ul>"},{"location":"resources/#youtube-videos","title":"YouTube Videos","text":"<ul> <li>Raspberry Pi 4 Home Server playlist by DB Tech is specifically about smart-home hosted on Raspberry Pi.</li> <li>Super Simple Cloudflare and Nginx Proxy Manager Setup Using YOUR Domain by Geeked</li> <li>CloudFlare - FREE Additional Security For Your Home Server! by DB Tech</li> </ul>"},{"location":"resources/#misc","title":"Misc","text":"<ul> <li>Awesome Home Assistant for general links related to Home Assistant</li> <li>Home Assistant Twitter for news and community interactions</li> </ul>"},{"location":"home-assistant/custom-extensions/","title":"Custom Extensions","text":"<p>Home Assistant has a lot of integrations, but sometimes it's not enough. Fortunately, Home Assistant provides a way to add external integrations.</p> <p>Below you will find integrations and Lovelace cards developed by me and by other smart-home enthusiasts.</p> <p>I use HACS for managing my third-party integrations and cards.</p>"},{"location":"home-assistant/custom-extensions/#developed-by-me","title":"Developed by Me","text":"<p>Sometimes even extensions provided by HACS are not enough, so I had to develop some extensions by myself.</p>"},{"location":"home-assistant/custom-extensions/#lovelace-cards","title":"Lovelace Cards","text":""},{"location":"home-assistant/custom-extensions/#vacuum-card","title":"<code>vacuum-card</code>","text":"<p>By default, Home Assistant does not provide any card for controlling vacuum cleaners. This card displays the state and allows you to control your robot.</p> <p></p>"},{"location":"home-assistant/custom-extensions/#purifier-card","title":"<code>purifier-card</code>","text":"<p>As for vacuums, Home Assistant doesn't provide any card for controlling air purifiers either. This card displays the state and allows to control your air purifier.</p> <p></p>"},{"location":"home-assistant/custom-extensions/#third-party","title":"Third party","text":"<p>Here's a list of extensions developed by other developers.</p>"},{"location":"home-assistant/custom-extensions/#lovelace-cards_1","title":"Lovelace Cards","text":"<ul> <li><code>mini-media-player</code> \u2014 The default one looks not so elegant and has way fewer options to display.</li> <li><code>mini-graph-card</code> \u2014 This one has a ton of different options. The killer feature for me: the ability to animate and display multiple graphs.</li> <li><code>mini-humidifier</code> \u2014 Simple and minimalistic. Default humidifier card allows displaying humidifiers only from <code>humidifier</code> domain, whereas my humidifier is available under <code>fan</code> domain. I don't actually like this card and plan to make my own to match the design of vacuum and purifier cards.</li> <li><code>lovelace-xiaomi-vacuum-map-card</code> \u2014 This card enables you to specify a target or start a zoned cleanup using a live or static map, just like in Xiaomi Home app. Additionally you can define a list of zones and choose the ones to be cleaned.</li> <li><code>state-switch</code> \u2014 This card is like a usual conditional card, but allows to make conditions based on the current user. I used this only to display appropriate Spotify player in Lovelace.</li> <li><code>bar-card</code> \u2014 This card is design to display progress bars.</li> <li><code>transmission-card</code> \u2014 This card is for displaying controls over Transmission torrent client.</li> </ul>"},{"location":"home-assistant/custom-extensions/#integrations","title":"Integrations","text":"<ul> <li>HACS (Home Assistant Community Store) \u2014 A store for easier management of <code>custom_components</code>.</li> <li>Xiaomi Cloud Map Extractor \u2014 This custom integration provides a way to present a live view of a map for a Xiaomi (and Roborock) vacuums.</li> <li>Adaptive Lighting \u2014 Adaptive Lighting slowly synchronizes your color-changing lights with the regular naturally occurring color temperature of the sky throughout the day. This gives your environment a more natural feel, with cooler hues during the midday and warmer tints near twilight and dawn. Built-in <code>flux</code> integration is very limited and bold.</li> <li>Car Wash \u2014 This component checks the weather forecast for several days in advance and concludes whether it is worth washing the car now.</li> <li>Snowtire \u2014 This component checks the weather forecast for several days in advance and concludes whether it is time to change car tires from summer to winter and vice versa.</li> <li>Powercalc \u2014 This component calculates estimated power consumption of lights and other appliances. This allows to make use of Energy dashboard even when you don't have smart electricity meters.</li> <li>Presence Simulation \u2014 This component looks for history of devices and simulates the history with a random shift. Very useful to simulate presence at home when we are away.</li> </ul>"},{"location":"home-assistant/dashboards/","title":"Dashboards","text":"<p>Below you're going to find my dashboards. I use those to display information and control accessories in my smart home.</p> <p>Warning</p> <p>I constantly update my smart home setup and tweaking UI to match my needs. Please, beware that the look of these dashboards on screenshots might differ from how they actually look right now.</p> <p>Please, visit the repo to see the current state of these dashboards.</p> <p>I use <code>mini-media-player</code> card for the media players and <code>mini-graph-card</code> for the graphs.</p>"},{"location":"home-assistant/dashboards/#home","title":"Home","text":"<p>This dashboard displays the information about my home in general.</p> <ul> <li>Scene controls of the scenes are located at the beginning of the dashboard to be accessible on the phone right away.</li> <li>Room buttons navigate to the room dashboards on the press, and turn off all lights in the room on hold.</li> <li>Media block helps to control my smart speakers and Spotify.</li> <li>Conditions contain information about the weather, indoor temperature, humidity, and pressure, UV-index outdoors, and AQI indoor as well as outdoor (from the nearby AQI station).</li> <li>Status display the information about our location, phone battery, and travel history for the last hours.</li> </ul> <p></p>"},{"location":"home-assistant/dashboards/#living-room","title":"Living Room","text":"<p>This dashboard controls the living room.</p> <ul> <li>Lights section controls all smart lights in this room.</li> <li>Media displays the information about my media players (Apple TV, Samsung TV, PS4, Google Nest Mini).</li> <li>Condition shows the current conditions in this room (climate, temperature, humidity, motion) and controls the air purifier via <code>purifier-card</code>.</li> </ul> <p></p>"},{"location":"home-assistant/dashboards/#bedroom","title":"Bedroom","text":"<p>This dashboard is for Bedroom related devices.</p> <ul> <li>Lights section controls all smart lights in this room.</li> <li>Media controls Google Home Mini smart speaker.</li> <li>Condition shows the current conditions in this room (temperature, humidity, motion) and controls the air humidifier via mini-humidifier.</li> </ul> <p></p>"},{"location":"home-assistant/dashboards/#balcony","title":"Balcony","text":"<p>This dashboard is for the Balcony. I use the Balcony as my workplace.</p> <ul> <li>Lights section controls all smart lights in this room.</li> <li>Media displays the information about my Spotify player.</li> </ul> <p></p>"},{"location":"home-assistant/dashboards/#vacuum","title":"Vacuum","text":"<p>This dashboard is for controlling a vacuum cleaner robot.</p> <ul> <li>Vacuum card for controlling a vacuum cleaner and scrips for quick access to the vacuum, which is hidden under the bed. I developed my own <code>vacuum-card</code> for vacuum management.</li> <li>A map for displaying the current position of the vacuum in my home. The map is blurred. I use <code>lovelace-xiaomi-vacuum-map-car</code> for displaying a live map, though <code>vacuum-card</code> is also capable of displaying live maps.</li> </ul> <p></p>"},{"location":"home-assistant/dashboards/#car","title":"Car","text":"<p>This dashboard lets me control my Toyota vehicle.</p> <ul> <li>Alarm controls let my arm/disarm my smart alarm, start/stop the engine, trigger horn.</li> <li>History map display the 24-hour path history of the vehicle.</li> <li>States are displaying the sensor states of the hood, doors, trunk, engine and interior temperature, connection quality.</li> </ul> <p>Info</p> <p>You may see that most of the controls and sensors are unavailable on the screenshots. That's because I keep my car in the underground parking, where the GSM connection is poor.</p> <p>Though, there's no need to worry, since the parking is secured with many security systems.</p> <p></p>"},{"location":"home-assistant/dashboards/#city","title":"City","text":"<p>This dashboard is created for monitoring city conditions.</p> <ul> <li>Air Quality displays AQI in my neighbourhood and Kyiv average, PM2.5 concentration indoor/outdoor and AQI map.</li> <li>Traffic displays realtime traffic map, congestion and traveltime to/from city center.</li> </ul>"},{"location":"home-assistant/dashboards/#observation","title":"Observation","text":"<p>This dashboard displays status of my plants, position of the sun, etc.</p> <p></p>"},{"location":"home-assistant/dashboards/#cameras","title":"Cameras","text":"<p>This dashboard lets me watch the live streams from Kyiv (where I live) and from Chernivtsi (where I've grown up). Unfortunately, there is a very small number of publicly accessible live cameras in Kyiv. Most of them are unstable and have very poor quality.</p> <p></p>"},{"location":"home-assistant/dashboards/#system","title":"System","text":"<p>This dashboard lets me overview the state of my smart home SystemHealthRegistration</p> <ul> <li>Internet and System section displays the Internet speed, ping, and connected devices. Below there are a group of sensor for CPU, RAM, Swap and Disk usage of my Raspberry Pi.</li> <li>Adguard Home let me monitor the DNS ad-blocking rates.</li> </ul> <p></p>"},{"location":"home-assistant/health-checks/","title":"Health Checks","text":"<p>Things will break, this is a matter of time. The electricity outage, crashes, interference, etc.</p> <p>You just must be prepared.</p>"},{"location":"home-assistant/health-checks/#home-assistant-instance","title":"Home Assistant Instance","text":"<p>I use HealthChecks.io service no notify me when my Home Assistant instance is down (critical crash, an Internet connection is lost, etc).</p> <p></p> <p>This service is dead-simple: it expects you to send requests at the specified time. As long as requests are received, everything is considered to be normal.</p> <p>When HealthChecks doesn't receive a request at the specified time, it will send me alerts via SMS.</p> <p>Why SMS?</p> <p>Because Home Assistant is offline and can't send me a notification via Internet, so SMS is the only reliable option.</p> <p>I've made a <code>rest_command</code> to send a request to HealthChecks:</p> <pre><code>rest_command:\n  healthcheck:\n    url: !secret healthcheck_ping\n</code></pre> <p>Automation to send a request every minute:</p> <pre><code>- id: healthcheck\n  alias: Healthcheck Connection\n  description: Send a ping to Healthcheck every minute\n  mode: single\n  trigger:\n    platform: time_pattern\n    minutes: /1\n  action:\n    - service: rest_command.healthcheck\n</code></pre>"},{"location":"home-assistant/health-checks/#unavailable-devices","title":"Unavailable Devices","text":"<p>Sometimes, my devices go offline when Home Assistant is updating or restarting for a long time.</p> <p>I made a sensor that checks the number of devices for <code>unavailable</code>, <code>unknown</code>, or <code>none</code> states. This sensor also includes their <code>entity_id</code>s and <code>friendly_names</code> to use in automation.</p> <pre><code>- platform: template\n  sensors:\n    unavailable_devices:\n      friendly_name: Unavailable Devices\n      value_template: &gt;-\n        {% set domains = [states.light, states.media_player, states.fan] %}\n        {% set states = ['unavailable', 'unknown', 'none'] %}\n        {{ expand(domains) | selectattr('state', 'in', states) | list | length }}\n      attribute_templates:\n        entities: &gt;-\n          {% set domains = [states.light, states.media_player, states.fan] %}\n          {% set states = ['unavailable', 'unknown', 'none'] %}\n          {{ expand(domains) | selectattr('state', 'in', states) | map(attribute='entity_id') | list }}\n        entities_names: &gt;-\n          {% set domains = [states.light, states.media_player, states.fan] %}\n          {% set states = ['unavailable', 'unknown', 'none'] %}\n          {{ expand(domains) | selectattr('state', 'in', states) | map(attribute='name') | list }}\n</code></pre> <p>This is automation that sends an alert every time there's more that 0 unavailable devices.</p> <pre><code>- id: unavailable_devices_notifications\n  alias: Unavailable Devices Alert\n  trigger:\n    platform: numeric_state\n    entity_id: sensor.unavailable_devices\n    above: 0\n    for:\n      minutes: 1\n  action:\n    # Notify yourself about these devices\n</code></pre>"},{"location":"home-assistant/introduction/","title":"Introduction","text":"<p>I use Home Assistant as my primary smart home software. It allows me to tied down every separate ecosystem, every device, and every service together.</p> <p>This is a very powerful tool, allowing to built complex and smart automation based on multiple triggers and conditions, performing different actions.</p> <p>So far, I'm happy with Home Assistant and strongly recommend trying it if you are a smart home enthusiast.</p>"},{"location":"home-assistant/introduction/#prior-art","title":"Prior Art","text":"<p>I began my smart home journey with an Aqara Hub and a few bulbs.</p> <p>In the beginning, I was hoping to consolidate my smart home over HomeKit, because I'd already had a few Apple devices. Shortly after, I run into multiple limitations. After a year of using Aqara setup, I decided to switch to the more universal and powerful solution \u2014 Home Assistant.</p> <p>Now I easily pass my devices to the HomeKit as well as to the Google Home app.</p>"},{"location":"home-assistant/introduction/#how-i-make-my-automations","title":"How I make my automations","text":"<p>Tip</p> <p>I highly suggest reading a blog post called Perfect Home Automation written by Home Assistant creator Paulus Schoutsen.</p> <p>This article contains valid points about developing home automation. This will help you develop the right mindset while building your smart home.</p> <p>There are a few rules I use while building my smart home:</p> <ul> <li>You should not adapt to technologies. Things should just work. You shouldn't break your own daily routines in order to adapt to your home. Home automation should blend with your current workflow, not replace it.</li> <li>You are not the only user of your home automation. Even when you live alone, you may have guests. Think about how they're going to use your home.</li> <li>Limit the impact of failures. Smart homes are complex: eventually, things will go wrong. Make sure things will have a limited impact when they fail. Ideally, devices should fall back to a pre-smart home experience.</li> <li>Automations must be seamless. Nobody controls lights from the phone except for showing off. This means that everything you automate has to work flawlessly. Even when automation works perfectly 90% of the time, the rest 10% will ruin the whole positive experience.</li> </ul> <p>That's what I keep in mind. This helps a lot.</p>"},{"location":"home-assistant/introduction/#device-tracking","title":"Device Tracking","text":"<p>Presence detection is done by combination of two components: ASUSWRT and Mobile App.</p> <ul> <li>ASUSWRT connects to my ASUS router and checks, if any of family members phones is connected to WiFi.</li> <li>Mobile App tracks our phone locations when we are not home. This integration also provides muscles info, like battery levels.</li> </ul>"},{"location":"home-assistant/speech/","title":"Speech","text":"<p>I do most of the interactions with my smart home using my voice. This page describes my voice control setup.</p>"},{"location":"home-assistant/speech/#home-speakers","title":"Home Speakers","text":"<p>None of the existing smart speakers supports the Ukrainian language (my native and primary language). I used English (US) for my devices.</p> <p>I have two Google smart speakers. I've decided to go with Google because Google Assistant is smart enough and well-integrated with different accessories.</p> <p>We use these speakers all the time, mostly asking to turn devices, activate scenes, start or stop vacuum, set timers or reminders. Besides, lack of Ukrainian language support, I'm pretty happy with these speakers. Sometimes I need to repeat my command twice for the speaker to pick up, but I consider it acceptable.</p> Google Home MiniGoogle Nest Mini <p>I got this one as a gift for New Year 2020.</p> <p></p> <p>This one I got as a gift for my birthday.</p> <p></p>"},{"location":"home-assistant/speech/#text-to-speech","title":"Text to Speech","text":"<p>I wanted to receive voice announcements for my smart home in Ukrainian. Fortunately, Google Translate TTS supports voice generation for the Ukrainian language.</p> <pre><code>tts:\n  - platform: google_translate\n    service_name: google_say\n    language: uk # Ukrainian\n    base_url: !secret external_url\n</code></pre> <p>This will generate phrases and send them to any speaker to play.</p>"},{"location":"home-assistant/speech/#announcements","title":"Announcements","text":"<p>I built a nice announcements script for myself. I use it like this:</p> <pre><code>service: script.announcement\ndata:\n  # Speak on smart speakers\n  speak: true\n  # Send notifications on devices\n  notify: true\n  # Title for notification\n  title: '\u041c\u0438\u0442\u0442\u044f \u0430\u0432\u0442\u043e \ud83d\ude98\u2600\ufe0f'\n  # Opening phrases\n  openings:\n    - '\u041d\u0430\u0439\u0431\u043b\u0438\u0436\u0447\u0438\u043c\u0438 \u0434\u043d\u044f\u043c\u0438 \u043e\u0447\u0456\u043a\u0443\u0454\u0442\u044c\u0441\u044f \u0445\u043e\u0440\u043e\u0448\u0430 \u043f\u043e\u0433\u043e\u0434\u0430.'\n    - '\u0425\u043e\u0440\u043e\u0448\u0430 \u043f\u043e\u0433\u043e\u0434\u0430 \u043d\u0430\u0439\u0431\u043b\u0438\u0436\u0447\u0456 7 \u0434\u043d\u0456\u0432.'\n    - '\u041f\u0440\u043e\u0433\u043d\u043e\u0437\u0443\u0454\u0442\u044c\u0441\u044f \u0445\u043e\u0440\u043e\u0448\u0430 \u043f\u043e\u0433\u043e\u0434\u0430!'\n  # Main phrases\n  messages:\n    - '\u0414\u043e\u0440\u0435\u0447\u043d\u043e \u043f\u043e\u043c\u0438\u0442\u0438 \u043c\u0430\u0448\u0438\u043d\u0443.'\n    - '\u0412\u0430\u0440\u0442\u043e \u043f\u043e\u0457\u0445\u0430\u0442\u0438 \u043d\u0430 \u0430\u0432\u0442\u043e\u043c\u0438\u0439\u043a\u0443.'\n    - '\u0412\u0434\u0430\u043b\u0438\u0439 \u0447\u0430\u0441, \u0449\u043e\u0431 \u043f\u043e\u043c\u0438\u0442\u0438 \u0430\u0432\u0442\u043e.'\n  # Additional data for notifications\n  # Categories or page to open on notification opening\n  notify_data:\n    url: /lovelace/car\n</code></pre> <p>This script will generate a unique announcement using random phrases from <code>greetings</code> and <code>messages</code>.</p> <p>The generated phrase will be spoken on smart speakers and sent as a notification to the phones. I can avoid speaking or notifying via <code>speak</code> and <code>notify</code> flags accordingly.</p> <p><code>notify_data</code> helps to pass notification categories for actionable notifications or <code>url</code> to open when I click on this notification.</p> <p>Speech Scripts</p>"},{"location":"home-assistant/speech/#do-not-disturb-flow","title":"Do Not Disturb Flow","text":"<p>It would be annoying to get a speech announcement in the middle of the night or a working meeting. That's why I built Do Not Disturb mode.</p> <p>Do Not Disturb is just automation that:</p> <ul> <li>Sets the volume of smarts speakers</li> <li>Turns on/off silence modes for fans</li> <li>Turns on/off led indicators</li> <li>Stops/starts voice announcements</li> </ul> <p>\u2026 based on the current time of day (sleeping or activity time) and a switch, I can toggle whenever I want.</p> <p>Do Not Disturb Automations</p>"},{"location":"home-assistant/vacuum-setup/","title":"Vacuum Setup","text":"<p>I have a Roborock S5 Max vacuum robot. It's paired with Home Assistant using built-in Xiaomi Miio integration.</p> <p>In order to get this device working with Home Assistant, you must obtain an access token, which is a bit tricky. Fortunately, there's a guide on how to get this token.</p> <p>I used a <code>vacuum-card</code> I built myself for controlling my vacuum and <code>lovelace-xiaomi-vacuum-map-card</code> for displaying a live map.</p> <p>You can find the latest state of my vacuum setup here:</p> <p>Automations Scripts</p>"},{"location":"home-assistant/vacuum-setup/#asking-to-start-cleaning","title":"Asking to start cleaning","text":"<p>I have a relatively complex set of automation for my vacuum.</p> <p>At first, I just used to start my robot every couple of days. It's not a good approach, because it always starts vacuuming right in the middle of a working call.</p> <p>Over time, I've changed logic to more complex and elegant.</p> <p>Now my vacuum sends an actionable notification asking to start cleaning, based on multiple conditions:</p> <ul> <li>Robot is docked.</li> <li>It's a working day.</li> <li>It's a time during working hours.</li> <li>Do Not Disturb mode is off. </li> <li>It's time to clean, meaning: the previous cleaning was too short to clean the whole home, or there was no cleaning in a reasonable period.</li> </ul> <p>When I think it's a good time to start cleaning, I press a button in the notification, and the robot starts cleaning.</p> <p>Additionally, the robot starts cleaning every time we leave our home, and it's time to clean.</p>"},{"location":"home-assistant/vacuum-setup/#asking-to-clean-itself","title":"Asking to clean itself","text":"<p>I solved this issue by automatically sending it to the trash bin after every 5th cleaning.</p> <p>The tricky part here is to tell the robot where to go. There is an article that helped me solve this issue: How I set up room-cleaning automation with Google Home, Home-Assistant and Xiaomi vacuum cleaner</p> <p>Using the method described in the article, I've found the location of my trash bin. In my case, it's:</p> <pre><code>[24500, 24500];\n</code></pre> <p>Now I can send the vacuum to this spot in my home, like this:</p> <pre><code>vacuum_maintenance:\n  alias: Vacuum Maintenance\n  icon: mdi:screwdriver\n  sequence:\n    - service: vacuum.send_command\n      entity_id: vacuum.roborock\n      data:\n        command: app_goto_target\n        params: [24500, 24500] # Coordinates near the trash bin\n</code></pre>"},{"location":"home-assistant/vacuum-setup/#cleaning-the-specific-room","title":"Cleaning the specific room","text":"<p>I made shortcuts for cleaning rooms separately. Here's a guide how to retrieve valid room number: Retrieving room numbers.</p> <p>Here are mine:</p> <pre><code>[\n  [16, '350001002902'], // Living Room\n  [17, '350001004993'], // Bedroom\n  [18, '350001010484'], // Corridor\n  [19, '350001010483'], // Bathroom\n  [20, '350001010672'], // Kitchen\n];\n</code></pre> <p>Using the first number in these tuples, I can send a vacuum to clean a specific room like this:</p> <pre><code># Single Room\nvacuum_clean_kitchen:\n  alias: Vacuum Clean Kitchen\n  icon: mdi:silverware-fork-knife\n  sequence:\n    - service: vacuum.send_command\n      data:\n        entity_id: vacuum.roborock\n        command: app_segment_clean\n        params: [20]\n\n# Multiple rooms\nvacuum_clean_living_room:\n  alias: Vacuum Clean Living Room\n  icon: mdi:sofa\n  sequence:\n    - service: vacuum.send_command\n      data:\n        entity_id: vacuum.roborock\n        command: app_segment_clean\n        params: [16, 20]\n</code></pre>"},{"location":"software/ad-blocking/","title":"Ad Blocking","text":"<p>Pi-hole is a powerful network-wide ads &amp; trackers blocking DNS server. Once it's set up, it'll cover all home devices, so there's no need to install any client-side software for that.</p> <p>Why Pi-hole? The have well supported docker image and they also have very broad community. Every aspect is well documented, so it's much easier to fix stuff when something goes wrong.</p> <p>Note</p> <p>Pi-hole blocks requests. This means it can break some websites sometimes.</p> <p>Warning</p> <p>On Ubuntu, there's an issue with <code>systemd-resolved</code> consuming port <code>53</code>, which is required for AdGuard.</p> <p>I've made a script <code>smart-home fix-systemd-resolved</code> that automatically fixes that issue.</p>"},{"location":"software/ad-blocking/#ad-blocking-list","title":"Ad Blocking List","text":"<p>Here are ad-blocking lists I use:</p> <ul> <li>Every green list on firebog.net</li> <li>Malware Domain List <code>https://www.malwaredomainlist.com/hostslist/hosts.txt</code></li> <li>NoTracking List <code>https://raw.githubusercontent.com/notracking/hosts-blocklists/master/adblock/adblock.txt</code></li> <li>YouTube Ads DNS <code>https://raw.githubusercontent.com/kboghdady/youTube_ads_4_pi-hole/master/youtubelist.txt</code></li> <li>Mobile Ads Filter <code>https://filters.adtidy.org/extension/chromium/filters/11.txt</code></li> <li>Annoyances Filter <code>https://filters.adtidy.org/extension/chromium/filters/14.txt</code></li> <li>Russian Ad Filter <code>https://filters.adtidy.org/extension/chromium/filters/1.txt</code></li> <li>Safari Filter <code>https://filters.adtidy.org/extension/chromium/filters/11.txt</code></li> </ul>"},{"location":"software/ad-blocking/#prior-ard","title":"Prior ard","text":"<p>Caution</p> <p>Previously, I used AdGuard Home to blocks advertisements.</p> <p>AdGuard is a Russian company, and this opens security concerns. Though it's legally registered in Cyprus, most of its developers work from Russian offices.</p> <p>After Russian invasion in Ukraine I decied to move away from AdGuard.</p> <p>I was using AdGuard Home as my primary ad-blocking solution. AdGuard is a DNS-based ad-blocking tool that checks and blocks requests to advertisement domains.</p> <p>There is a Docker container for AdGuard Home.</p> <p>However, make sure your Internet provider allows custom DNS. My provider was blocking this, and I spend a lot of time trying to figure out what's wrong.</p>"},{"location":"software/docker/","title":"Docker Containers","text":""},{"location":"software/docker/#portainer-ce","title":"Portainer CE","text":"<p>Portainer is a lightweight management UI that allows easy Docker management.</p> <p>I use it for restarting, stoping, killing docker containers. I can check logs, ports, statistics. This is my primary tool, that replaces Home Assistant Supervisor.</p>"},{"location":"software/docker/#home-assistant","title":"Home Assistant","text":"<p>Home Assistant is an open-source home automation platform that puts local control and privacy first. This is the heart of my smart home.</p> <p>Home Assistant powers my home automation binds my devices together, passes them to Google Home and HomeKit, etc.</p> <p>You can read more about it in Home Assistant section of this documentation.</p>"},{"location":"software/docker/#mosquitto","title":"Mosquitto","text":"<p>Eclipse Mosquitto is lightweight and is suitable for use on all devices from low power single board computers to full servers.</p> <p>In my case, this is an MQTT broker (basically, a man in the middle) between Home Assistant MQTT integration and Zigbee2MQTT container. This is necessary to incorporate my Zigbee devices into my smart home.</p>"},{"location":"software/docker/#zigbee2mqtt","title":"zigbee2mqtt","text":"<p>zigbee2mqtt is a container for connecting Zigbee devices without proprietary Zigbee bridges. It bridges events and allows controlling Zigbee devices via MQTT.</p> <p>In my case, it bridges my Zigbee devices to Home Assistant via CC2531 sniffer. You can read more about it in the Hardware section.</p>"},{"location":"software/docker/#esphome","title":"ESPHome","text":"<p>ESPHome is a system to control ESP8266/ESP32 devices by simple and powerful configuration files and control them remotely through Home Automation systems.</p> <p>I use ESPHome for connecting and controlling my Midea AC remotely.</p>"},{"location":"software/docker/#duplicati","title":"Duplicati","text":"<p>Duplicati is a backup software to store encrypted backups online. It works standard protocols like FTP or SSH and cloud services.</p> <p>I use Duplicati as a replacement for Supervisor's Snapshots. It allows to schedule incremental backups, encrypt them, upload to cloud services (Google Drive, Dropbox). Additionally, it gives an ability to restore granularly (only specified files or folders).</p>"},{"location":"software/docker/#mariadb","title":"MariaDB","text":"<p>MariaDB is a high-performing open-source relational database, forked from MySQL.</p> <p>Long story short, it's a fast, light, and backward compatible with MySQL database solution. I use it as a SQL database for my smart home. This is used by Nginx Proxy Manager.</p>"},{"location":"software/docker/#adminer","title":"Adminer","text":"<p>Adminer (formerly phpMinAdmin) is a full-featured database management tool written in PHP.</p> <p>It's a dead-simple UI for my MariaDB database.</p>"},{"location":"software/docker/#nginx-proxy-manager","title":"Nginx Proxy Manager","text":"<p>Nginx Proxy Manager is a Docker container for managing Nginx proxy hosts with a simple, powerful interface.</p> <p>This allows me to easily expose services from my local network to the internet. It automatically requests, invalidates, and renews SSL certificates from Let's Encrypt.</p>"},{"location":"software/docker/#airconnect","title":"AirConnect","text":"<p>AirConnect is a simple tool to make UPnP/Sonos &amp; Chromecast devices available via AirPlay.</p>"},{"location":"software/docker/#samba","title":"Samba","text":"<p>Samba Docker container allows me to share folders from my machine as Samba volumes. I use it to expose my home config folder (<code>smart-home</code>) and my media vault (<code>media</code>).</p>"},{"location":"software/docker/#pi-hole","title":"Pi-hole","text":"<p>Pi-hole is a powerful network-wide ads &amp; trackers blocking DNS server.</p> <p>Once it's set up, it'll cover all home devices, so there's no need to install any client-side software for that.</p> <p>You can read more about it in a section about Ad-Blocking.</p> <p>Note</p> <p>Previously, I used AdGuard Home to blocks advertisements. AdGuard is a company founded and developed by Russians. After Russian invasion in Ukraine I decied to move away from AdGuard.</p>"},{"location":"software/docker/#plex","title":"Plex","text":"<p>Plex Media Server organizes video, music, and photos from personal media libraries and streams them to smart TVs, streaming boxes, and mobile devices.</p> <p>Basically, this is a self-hosted Netflix. Plex helps me expose and manage media files from the hard drive wired to Raspberry Pi. It finds localized metadata for my media: descriptions, reviews, posters, and soundtracks.</p> <p>Media is downloaded via Transmission.</p>"},{"location":"software/docker/#transmission","title":"Transmission","text":"<p>Transmission is a popular BitTorrent client. It can be hosted as a Docker container \u2014 that's exactly what I did.</p> <p>I use it for downloading media to my hard drive.</p>"},{"location":"software/docker/#sonarr-radarr-prowlar","title":"Sonarr, Radarr, Prowlar","text":"<p>Servarr stack containers provide media managing platform. Prowlarr provides proxy-API for popular torrent trackers. Sonarr monitors TV Series, downloads and organize them. Radarr does the same as Sonarr, but for movies.</p>"},{"location":"software/docker/#bitwarden","title":"Bitwarden","text":"<p>Bitwarden is an open-source password manager that can be self-hosted. I'm using Vaultwarden, which is an unofficial Bitwarden client written in Rust. Vaultwarden is especially useful for low powerful machines, like Raspberry Pi.</p>"},{"location":"software/docker/#homer","title":"Homer","text":"<p>Homer is a smart home dashboard. I use it for having a quick access to the links of my smart-home services in a single place.</p>"},{"location":"software/external-access/","title":"External Access","text":"<p>This page describes how I make my smart home accessible from the outer world.</p>"},{"location":"software/external-access/#prior-art","title":"Prior art","text":"<p>When I was running Home Assistant OS, I had DuckDNS add-on installed. DuckDNS addon is the simplest way to make your HA instance available externally available. It will automatically point your DuckDNS record to your router's IP and request a Let's Encrypt SSL certificate.</p> <p>Downsides of this approach:</p> <ul> <li>it is not so convenient when you try to expose more services as subdomains;</li> <li>it exposes your router's IP to everyone on the internet, making you vulnerable to DDoS attacks.</li> </ul> <p>That's why I've migrated to a more universal setup.</p>"},{"location":"software/external-access/#reverse-proxy-via-nginx-proxy-manager","title":"Reverse proxy via Nginx Proxy Manager","text":"<p>Nginx Proxy Manager is a Docker container for managing Nginx proxy hosts with a simple, powerful interface. It makes reverse proxying a breeze.</p> <p>It let you configure proxies via UI, making it easy, especially for those who don't have any experience with Nginx. It automatically requests, invalidates, and renews SSL certificates from Let's Encrypt. It blocks common attacks. It provides basic auth for unsecured services.</p> <p>It's simple and powerful. I highly recommend it for your home networks.</p>"},{"location":"software/external-access/#dns-via-cloudflare","title":"DNS via Cloudflare","text":"<p>Cloudflare is a company that provides free DNS and CDN services.</p> <p>Cloudflare gives lots of useful services for free, and it's easy to set up. It gives a free additional level of security by hiding your router's IP, DDoS mitigation, firewall, access policies, etc. It also improves performance by caching and wide CDN.</p> <p>The most important use-cases for me: hiding my home IP and protecting from common attacks.</p> <p>My main DNS A-type record exposes my Nginx Proxy Manager (ports <code>80</code> and <code>443</code>). This name record points to my Home Assistant instance. Other services are exposed via CNAME-type records pointing to the main A-type record.</p> <p>To avoid issues with DDNS, I have enabled Cloudflare integration for Home Assistant for updating my home IP in Cloudflare DNS records.</p>"},{"location":"software/external-access/#accessing-ssh-and-samba-via-openvpn","title":"Accessing SSH and Samba via OpenVPN","text":"<p>Using Cloudflare makes it impossible to access my home via SSH using a domain name. Additionally, I don't want to expose any other ports on my router except <code>80</code> and <code>443</code>.</p> <p>My router has a built-in OpenVPN server. When I want to SSH into my home server or open a volume over SSH, I just connect to my home VPN. Once I am connected, I can do everything, like I'm connected to my home WiFi.</p>"},{"location":"software/getting-started/","title":"Getting Started","text":"<p>My smart home can be quickly deployed using this guide:</p> <ul> <li>Backup everything before performing any action.</li> <li>Backup <code>smart-home</code> folder <code>tar czvf smart-home.tar.gz smart-home</code></li> <li>Backup Plex libary <code>tar czvf plex.tar.gz ~/Plex</code></li> <li>Copy archives locally via <code>scp</code></li> <li>Install Ubuntu Server on card via Raspberry Pi Imager.</li> <li>Plug SSD in Raspberry Pi. Let it a few minutes to start.</li> <li>Connect via ssh using <code>ssh ubuntu@&lt;ip&gt;</code>. You can get the IP in router's connected devices panel.</li> <li>Clone <code>smart-home</code> to home folder or restore from backups</li> <li>Add smart-home binaries to <code>PATH</code> and set <code>SMART_HOME_DIR</code>:   <pre><code>echo 'export SMART_HOME_DIR=\"$HOME/smart-home\"' &gt;&gt; ~/.bashrc\necho 'export PATH=\"$PATH:$HOME/smart-home/bin\"' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n</code></pre></li> <li>Init smart-home via <code>smart-home init</code>.</li> <li>Fix network manager vie <code>smart-home setup-network</code>.</li> <li>Fix network manager vie <code>smart-home fix-systemd-resolved</code>.</li> <li>Fill secret credentials in <code>.env</code> file. Use <code>smart-home password</code> to generate new passwords.</li> <li>Go to Cockpit dashboard (<code>https://&lt;ip&gt;:</code>) and set hostname, mount external storage. Reboot after changes.</li> <li>Spin up containers via <code>smart-home start</code>. This command will pull down images and star up containers.</li> </ul>"},{"location":"software/media/","title":"Media Managing","text":"<p>My media stack is based on Serarr containers, namely: Radarr, Sonarr and Prowlarr.</p> <p>I've written a thread about my media stack (in Ukrainian):</p> <p>\u0412\u0438\u0442\u0440\u0430\u0442\u0438\u0432 \u0441\u0432\u0456\u0439 \u0441\u044c\u043e\u0433\u043e\u0434\u043d\u0456\u0448\u043d\u0456\u0439 \u0432\u0438\u0445\u0456\u0434\u043d\u0438\u0439, \u0449\u043e\u0431 \u043d\u0430\u043b\u0430\u0448\u0442\u0443\u0432\u0430\u0442\u0438 \u0441\u043e\u0431\u0456 \u0443\u043b\u044c\u0442\u0438\u043c\u0430\u0442\u0438\u0432\u043d\u0438\u0439 \u043c\u0435\u0434\u0456\u0430 \u0441\u0442\u0435\u043a \u043d\u0430 \u0434\u043e\u043c\u0430\u0448\u043d\u044c\u043e\u043c\u0443 \u0441\u0435\u0440\u0432\u0435\u0440\u0456. \u0422\u0435\u043f\u0435\u0440 \u0444\u0430\u043a\u0442\u0438\u0447\u043d\u043e \u043c\u0430\u044e \u0434\u043e\u043c\u0430\u0448\u043d\u0456\u0439 \u0441\u0442\u0440\u0456\u043c\u0456\u043d\u0433 \u0437 \u043c\u043e\u043d\u0456\u0442\u043e\u0440\u0438\u043d\u0433\u043e\u043c \u043d\u043e\u0432\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0443 \u0442\u0430 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u043d\u0438\u043c \u043c\u0435\u043d\u0435\u0434\u0436\u043c\u0435\u043d\u0442\u043e\u043c.\u041f\u0438\u0442\u0430\u0439\u0442\u0435. pic.twitter.com/W4Za4ZWcVr</p>\u2014 Denys \ud83d\udc68\u200d\ud83d\udcbb\ud83c\uddfa\ud83c\udde6 (@denysdovhan) March 10, 2023"},{"location":"software/media/#downloading","title":"Downloading","text":"<p>Prowlarr indexes vairous torrent trackers with content. Sonarr and Radarr use these indexes to find new TV series and movies in a best possible quality. They send content to download client, which is Transmission. Transmission downloads content to my hard drive. Plex takes content on the hard drive and serves it, like self-hosted streaming service.</p>"},{"location":"software/media/#media-organisation","title":"Media Organisation","text":"<p>Sonarr and Radarr use hard-links in order to keep files in two places, but take only single space on the hard drive.</p> <p>Why? Because we also want to seed torrents and we should maintain original filenames in order to do that.</p>"},{"location":"software/media/#custom-profiles-for-better-downloads","title":"Custom Profiles for better downloads","text":"<p>I took some inspirations from TRaSH Guides in order to create my custom quality profiles for downloads.</p> <p>I also added a few more profiles for lanuages, since I prefer to watch my content in my native language - Ukrainian.</p> <p>I have three major lanuage profiles:</p> <ul> <li>Ukrainian audio - +3500 points</li> <li>Ukrainian subs - +3000 points</li> <li>Not Ukrainian or English - -10000</li> </ul> <p>As you see from above, movies and series with Ukrainian lanuage get promoted, when movies without both English and Ukrainian will practivally never be downloaded.</p>"},{"location":"software/ports/","title":"Ports","text":"<p>Here's a table of services and ports exposed via <code>docker-compose</code>:</p> Service Exposed port Cockpit 9090 Portainer CE 9000 Home Assistant 8123 Mosquitto 1888 Zigbee2MQTT 8099 ESPHome 6052 Duplicati 8200 Adminer 8080 Nginx Proxy Manager 80, 443, 8081 Samba 139, 445, 137, 138 Pi-hole 53, 67, 5300 Plex 32400, 3005, 5353, 1900, 8324, 32469, 32410, 32412, 32413, 32414 Transmission 9091, 51413 Vaultwarden 3880 Sonarr 8989 Radarr 7878 Prowlarr 9696 PS5MQTT 8645 <p>Info</p> <p>Some services are exposed as <code>network_mode: host</code>, so some exposed port might not be listed in the table below.</p>"},{"location":"software/system/","title":"System Overview","text":"<p>This page describes my system setup. Here you can find software I rely on for running my smart home system.</p>"},{"location":"software/system/#ubuntu-server-2204-lts","title":"Ubuntu Server 22.04 LTS","text":"<p>I use Ubuntu as a primary OS for my Raspberry Pi. Ubuntu is a well-maintained Linux distribution with a huge community and large support forums.</p> <p>It officially supports Raspberry Pi and can be easily installed via the official Raspberry Pi Imager.</p>"},{"location":"software/system/#docker","title":"Docker","text":"<p>I use Docker for managing all containers in my smart home.</p> <p>Docker allows to encapsulate everything related to a single service within a container. This approach helps to maintain host system clean and manage (start, stop, update and delete) every container separately.</p> <p><code>docker-compose</code> helps to describe my whole setup in a single file and manage it with a few commands.</p>"},{"location":"software/system/#cockpit","title":"Cockpit","text":"<p>Cockpit is a web-based graphical interface for servers. Ubuntu is officially supported.</p> <p>This tool let me easily manage my system from web browser: network, external drives, processes and services, system update, etc.</p>"},{"location":"software/system/#smart-home","title":"smart-home","text":"<p>This is just a bash script I wrote for personal need. You can find it here.</p> <p>This performs typical tasks I do in my smart home, like bootstraping, controlling server, updating, etc.</p>"},{"location":"software/system/#prior-art","title":"Prior art","text":""},{"location":"software/system/#home-assistant-os","title":"Home Assistant OS","text":"<p>Previously, I've been using Home Assistant OS installation. Home Assistant OS was installed directly on my Raspberry Pi, controlling every aspect of it.</p> <p>Info</p> <p>Home Assistant OS is nice, especially for newbies. Supervisor handles everything: networking, addons, updates, backups, etc. This lets you start quickly, automate your home, thinking in a safe box.</p> <p>Please, use it if you don't fell confident enough in networking, Linux, and DevOps stuff.</p> <p>The only major downside is an inability to control the system. You cannot host custom software alongside Home Assistant, you don't have full access to your system, you cannot mount external drives.</p> <p>As my knowledge was growing, so was my demands. Raspberry Pi is a very capable device, so I knew I can host more useful things for my home on it. First of all, I wanted to hook up an external hard drive and stream my media via Plex.</p> <p>However, leaving Home Assistant OS means no more benefits of Supervisor. I should manage my system myself: network, updates, backups. This bears more responsibility and headache.</p> <p>I've been developing an alternative solution gradually for a few months, looking for a replacement for every part of the Supervisor's functionality. Then, when I felt confident, I migrated to my new setup.</p>"},{"location":"software/system/#home-assistant-supervised","title":"Home Assistant Supervised","text":"<p>I was running HA Supervies for a year or so. This worked well for me, though I've decied to move back to Container since it gives much more freedom and control over my system.</p>"}]}