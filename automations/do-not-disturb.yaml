- id: do_not_disturb
  alias: Do Not Disturb Flow
  description: Adjust devices to Do Not Disturb mode
  mode: queued
  trigger:
    - platform: homeassistant
      event: start
    - platform: state
      entity_id: input_boolean.do_not_disturb
  condition:
    - condition: state
      entity_id: group.family
      state: 'home'
  action:
    - service: script.do_not_disturb_mode

- id: do_not_disturb_while_sleeping_time
  alias: Do Not Disturb while Sleeping Time
  description: Switch Do Not Disturb along with Sleeping Time
  trigger:
    - platform: homeassistant
      event: start
    - platform: state
      entity_id: binary_sensor.sleeping_time
  condition:
    - condition: state
      entity_id: group.family
      state: 'home'
  action:
    - service: input_boolean.turn_{{ states('binary_sensor.sleeping_time') }}
      entity_id: input_boolean.do_not_disturb

- id: do_not_disturb_on_calls
  alias: Do Not Disturb on calls
  description: Switch Do Not Disturb while camera or mics are on
  trigger:
    - platform: state
      entity_id: binary_sensor.denys_on_call
      for:
        minutes: 1
    - platform: state
      entity_id: binary_sensor.marry_on_call
      for:
        minutes: 1
  condition:
    - condition: state
      entity_id: binary_sensor.sleeping_time
      state: 'off'
    - condition: state
      entity_id: group.family
      state: 'home'
  action:
    - service: input_boolean.turn_{{ trigger.to_state.state }}
      entity_id: input_boolean.do_not_disturb
